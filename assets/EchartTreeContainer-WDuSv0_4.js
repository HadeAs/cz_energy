import{ag as Q,S as W,r as u,T as X,w as Y,v as ee,o as h,c as k,a as f,J as o,B as m,L as ae,F as D,x as O,aw as F,V as te,A as oe,Z as le,ac as ne,G as se,O as g,a1 as re,a2 as ce,a0 as de,ao as ie,a4 as ue,a5 as me}from"./index-C-tyC_6H.js";import{t as fe,E as pe}from"./toString-E3hzjqN7.js";import"./checkbox-t98SXIDk.js";import{E as he,a as ve}from"./form-item-2Qq2kISt.js";import{E as _e,a as ke}from"./tab-pane-2yc0Ilf_.js";import{_ as ge}from"./Echart-JPTqydfW.js";import{P as Ne}from"./ProDrawer-80_OB0OG.js";import{C as be}from"./formConfig-7IyXZZgD.js";/* empty css                */import"./overlay-tk1qTxpW.js";import{E as ye}from"./index-6f9Nkb3A.js";import{E as Ce}from"./index-EB5xhOSR.js";var Ee=fe,Ve=0;function xe(n){var N=++Ve;return Ee(n)+N}var we=xe;const Te=Q(we),M=n=>(ue("data-v-a6c24e6f"),n=n(),me(),n),Ie={class:"echart-tree-container"},Se={class:"left"},Be={class:"left-title"},De=M(()=>f("span",null,"数据对比",-1)),Oe={class:"right"},Fe={class:"right-title"},Me=M(()=>f("span",{class:"select-var"},"选择变量",-1)),Ae=["onMouseenter"],Re=["onClick"],qe={__name:"EchartTreeContainer",props:{showSwitch:{type:Boolean,default:!1},allowAddVar:{type:Boolean,default:!1},allowDelVar:{type:Boolean,default:!1},treeData:{type:Array,default:[]},chartOption:{type:Object},defaultTreeCheckKeys:{type:Array,default:[]}},emits:["type-change","tree-check-change"],setup(n,{expose:N,emit:A}){const R=n;N({getCheckedNodes:()=>s.value.getCheckedNodes()});const V=A,s=u(),b=u(""),y=u(),x=u(),C=u(""),w=u("hour"),c=u(R.treeData),T=u([]),d=X({groupName:"",varName:""});Y(b,a=>{s.value&&s.value.filter(a)});const q=(a,e)=>a?e.label.includes(a):!0,$=a=>{C.value=a},P=()=>{C.value=""},I=()=>{const a=s.value.getCheckedNodes(),e=a.filter(t=>!t.children);if(e.length){const t=e[0];c.value.forEach(r=>{r.children.find(i=>i.id===t.id)||(r.disabled=!0,r.children.forEach(i=>{i.disabled=!0}))})}else c.value.forEach(t=>{t.disabled=!1,t.children.forEach(r=>{r.disabled=!1})});c.value=[...c.value],g(()=>{s.value.setCheckedNodes(a)})},S=()=>{V("tree-check-change"),I()},U=()=>{y.value.open(),d.groupName="",d.varName="";const a=[];c.value.forEach(e=>{a.push({label:e.label,value:e.label})}),T.value=a},G=()=>{x.value.validate().then(()=>{y.value.close(),j()}).catch(()=>{})},j=()=>{const a=s.value.getCheckedNodes();c.value.forEach(e=>{if(e.label===d.groupName){e.children.push({id:Te("var_tree_"),label:d.varName});const t=a.findIndex(r=>r.id===e.id);t!==-1&&a.splice(t,1)}}),c.value=[...c.value],g(()=>{s.value.setCheckedNodes(a)})},K=(a,e)=>{ye.confirm("确认删除该变量嘛？","警告",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{L(a,e),Ce({type:"success",message:"删除成功"})}).catch(()=>{})},L=(a,e)=>{const t=s.value.getCheckedNodes(),r=t.findIndex(p=>p.id===e.id);r!==-1&&t.splice(r,1);const i=a.parent,v=i.data.children||i.data,_=v.findIndex(p=>p.id===e.id);v.splice(_,1),c.value=[...c.value],g(()=>{s.value.setCheckedNodes(t),S()})},z=a=>{V("type-change",a);const e=s.value.getCheckedNodes();g(()=>{s.value.setCheckedNodes(e)})};return ee(()=>{I()}),(a,e)=>{const t=_e,r=ke,i=re,v=ce,_=he,p=de,H=ve,J=pe,Z=ie;return h(),k("div",Ie,[f("div",Se,[f("div",Be,[De,o(r,{style:ae({visibility:n.showSwitch?"initial":"hidden"}),modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),onTabChange:z},{default:m(()=>[o(t,{label:"时能耗",name:"hour"}),o(t,{label:"天能耗",name:"day"}),o(t,{label:"月能耗",name:"month"}),o(t,{label:"年能耗",name:"year"})]),_:1},8,["style","modelValue"])]),o(ge,{option:n.chartOption},null,8,["option"])]),f("div",Oe,[o(Z,null,{default:m(()=>[f("div",Fe,[Me,n.allowAddVar?(h(),k("div",{key:0,class:"btn-add",onClick:U}," +添加 ")):D("",!0),o(Ne,{title:"添加变量",ref_key:"drawerRef",ref:y,onConfirm:G},{default:m(()=>[o(H,F({ref_key:"formRef",ref:x},O(be),{model:d}),{default:m(()=>[o(_,{label:"变量组",required:"",prop:"groupName"},{default:m(()=>[o(v,{modelValue:d.groupName,"onUpdate:modelValue":e[1]||(e[1]=l=>d.groupName=l),placeholder:"选择变量组"},{default:m(()=>[(h(!0),k(te,null,le(T.value,l=>(h(),oe(i,F({key:l},l),null,16))),128))]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"变量名称",required:"",prop:"varName"},{default:m(()=>[o(p,{modelValue:d.varName,"onUpdate:modelValue":e[2]||(e[2]=l=>d.varName=l)},null,8,["modelValue"])]),_:1})]),_:1},16,["model"])]),_:1},512)]),o(p,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),placeholder:"请输入内容","prefix-icon":O(ne),style:{"margin-bottom":"10px"}},null,8,["modelValue","prefix-icon"]),o(J,{data:c.value,"show-checkbox":"","node-key":"id",ref_key:"treeRef",ref:s,"default-expand-all":"",onCheck:S,"expand-on-click-node":!1,"filter-node-method":q,"default-checked-keys":n.defaultTreeCheckKeys},{default:m(({node:l,data:E})=>[f("div",{class:"custom-tree-node",onMouseenter:B=>$(E.id),onMouseleave:e[4]||(e[4]=B=>P())},[f("span",null,se(l.label),1),C.value===E.id&&n.allowDelVar?(h(),k("span",{key:0,onClick:B=>K(l,E),class:"del-btn"},"删除",8,Re)):D("",!0)],40,Ae)]),_:1},8,["data","default-checked-keys"])]),_:1})])])}}},We=W(qe,[["__scopeId","data-v-a6c24e6f"]]);export{We as E};
